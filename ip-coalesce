#!/usr/bin/env python
import ipaddress
from sys import stdin
from collections import defaultdict

nets = defaultdict(list)
for i in stdin.read().splitlines():
	if ' - ' in i:
		i = i.split(' - ')
		newnets = ipaddress.summarize_address_range(
			ipaddress.IPv4Address(i[0]),
			ipaddress.IPv4Address(i[1]),
		)
	else:
		newnets = [ipaddress.ip_network(i)]
	for n in newnets:
		nets[n.prefixlen].append(n)

for prefixlen in range(32, 0, -1):
	for net in nets[prefixlen][:]:
		for superprefixlen in range(1, prefixlen):
			found = False
			for supernet in nets[superprefixlen]:
				if net.subnet_of(supernet):
					print(net, 'subnet of', supernet)
					nets[prefixlen].remove(net)
					found = True
					break
			if found:
				break

for prefixlen in nets:
	nets[prefixlen] = [int(i.network_address) for i in nets[prefixlen]]

for prefix in range(32, 0, -1):
	# mask for supernet
	mask = 0xffffffff - ((1 << 32-(prefix-1)) - 1)
	for supernet in set(i & mask for i in nets[prefix]):
		supernet_ips = [
			i for i in nets[prefix]
			if i & mask == supernet
		]
		if len(supernet_ips) == 2:
			print('coalescing %s' % [
				ipaddress.ip_network((i, prefix))
				for i in supernet_ips
			])
			nets[prefix-1].append(min(supernet_ips))
			for i in supernet_ips:
				nets[prefix].remove(i)

for prefixlen, subnets in nets.items():
	for subnet in subnets:
		print(ipaddress.ip_network((subnet, prefixlen)))
